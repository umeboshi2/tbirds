var MainChannel, createMainApp;

import Backbone from 'backbone';

import {
  Region
} from 'backbone.marionette';

import RootApp from './root-app';

import MessagesApp from './tkmessages';

import NavbarApp from './tknavbar';

import RouterApp from './tkrouter';

MainChannel = Backbone.Radio.channel('global');

createMainApp = function(cfg) {
  var layout, mainApp, nbApp, nbview, options, rootEl, rootRegion, useMessages, useNavbar, useRouter;
  rootEl = (cfg != null ? cfg.appRegion : void 0) || 'body';
  rootRegion = new Region({
    el: rootEl
  });
  mainApp = new RootApp({
    appConfig: cfg,
    region: rootRegion
  });
  mainApp.setState('appConfig', cfg);
  MainChannel.reply('main:app:object', function() {
    return mainApp;
  });
  MainChannel.reply('main:app:config', function() {
    return mainApp.getOption('appConfig');
  });
  layout = mainApp.getView();
  // setup messages
  useMessages = true;
  if ((cfg.useMessages != null) && cfg.useMessages === false) {
    useMessages = false;
  }
  if (useMessages) {
    mainApp.addChildApp('messages', MessagesApp, {
      region: layout.getRegion('messages'),
      appConfig: cfg,
      parentApp: mainApp
    });
  }
  // setup navbar
  useNavbar = true;
  if ((cfg.useNavbar != null) && cfg.useNavbar === false) {
    useNavbar = false;
  }
  if (useNavbar) {
    nbApp = mainApp.addChildApp('navbar', NavbarApp, {
      region: layout.getRegion('navbar'),
      startWithParent: true,
      appConfig: cfg,
      parentApp: mainApp
    });
    if (cfg.hasUser) {
      nbview = nbApp.getView();
      options = {
        region: nbview.getRegion('userEntries'),
        startWithParent: true,
        appConfig: cfg,
        parentApp: nbApp,
        user: MainChannel.request("main:app:decode-auth-token")
      };
      nbApp.addChildApp('user-menu', cfg.userMenuApp, options);
    }
  }
  useRouter = true;
  if ((cfg.useRouter != null) && cfg.useRouter === false) {
    useRouter = false;
  }
  if (useRouter) {
    mainApp.addChildApp('router', RouterApp, {
      startWithParent: true,
      appConfig: cfg,
      parentApp: mainApp
    });
  }
  return mainApp;
};

export default createMainApp;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhcnQtbWFpbi1hcHAuanMiLCJzb3VyY2VzIjpbInN0YXJ0LW1haW4tYXBwLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFBLFdBQUEsRUFBQTs7QUFBQSxPQUFPLFFBQVAsTUFBQTs7QUFDQSxPQUFBO0VBQVMsTUFBVDtDQUFBLE1BQUE7O0FBRUEsT0FBTyxPQUFQLE1BQUE7O0FBQ0EsT0FBTyxXQUFQLE1BQUE7O0FBQ0EsT0FBTyxTQUFQLE1BQUE7O0FBQ0EsT0FBTyxTQUFQLE1BQUE7O0FBRUEsV0FBQSxHQUFjLFFBQVEsQ0FBQyxLQUFLLENBQUMsT0FBZixDQUF1QixRQUF2Qjs7QUFFZCxhQUFBLEdBQWdCLFFBQUEsQ0FBQyxHQUFELENBQUE7QUFDaEIsTUFBQSxNQUFBLEVBQUEsT0FBQSxFQUFBLEtBQUEsRUFBQSxNQUFBLEVBQUEsT0FBQSxFQUFBLE1BQUEsRUFBQSxVQUFBLEVBQUEsV0FBQSxFQUFBLFNBQUEsRUFBQTtFQUFFLE1BQUEsa0JBQVMsR0FBRyxDQUFFLG1CQUFMLElBQWtCO0VBQzNCLFVBQUEsR0FBYSxJQUFJLE1BQUosQ0FBVztJQUFBLEVBQUEsRUFBSTtFQUFKLENBQVg7RUFDYixPQUFBLEdBQVUsSUFBSSxPQUFKLENBQ1I7SUFBQSxTQUFBLEVBQVcsR0FBWDtJQUNBLE1BQUEsRUFBUTtFQURSLENBRFE7RUFHVixPQUFPLENBQUMsUUFBUixDQUFpQixXQUFqQixFQUE4QixHQUE5QjtFQUNBLFdBQVcsQ0FBQyxLQUFaLENBQWtCLGlCQUFsQixFQUFxQyxRQUFBLENBQUEsQ0FBQTtBQUNuQyxXQUFPO0VBRDRCLENBQXJDO0VBRUEsV0FBVyxDQUFDLEtBQVosQ0FBa0IsaUJBQWxCLEVBQXFDLFFBQUEsQ0FBQSxDQUFBO0FBQ25DLFdBQU8sT0FBTyxDQUFDLFNBQVIsQ0FBa0IsV0FBbEI7RUFENEIsQ0FBckM7RUFFQSxNQUFBLEdBQVMsT0FBTyxDQUFDLE9BQVIsQ0FBQSxFQVZYOztFQVlFLFdBQUEsR0FBYztFQUNkLElBQUcseUJBQUEsSUFBcUIsR0FBRyxDQUFDLFdBQUosS0FBbUIsS0FBM0M7SUFDRSxXQUFBLEdBQWMsTUFEaEI7O0VBRUEsSUFBRyxXQUFIO0lBQ0UsT0FBTyxDQUFDLFdBQVIsQ0FBb0IsVUFBcEIsRUFBZ0MsV0FBaEMsRUFDRTtNQUFBLE1BQUEsRUFBUSxNQUFNLENBQUMsU0FBUCxDQUFpQixVQUFqQixDQUFSO01BQ0EsU0FBQSxFQUFXLEdBRFg7TUFFQSxTQUFBLEVBQVc7SUFGWCxDQURGLEVBREY7R0FmRjs7RUFxQkUsU0FBQSxHQUFZO0VBQ1osSUFBRyx1QkFBQSxJQUFtQixHQUFHLENBQUMsU0FBSixLQUFpQixLQUF2QztJQUNFLFNBQUEsR0FBWSxNQURkOztFQUVBLElBQUcsU0FBSDtJQUNFLEtBQUEsR0FBUSxPQUFPLENBQUMsV0FBUixDQUFvQixRQUFwQixFQUE4QixTQUE5QixFQUNOO01BQUEsTUFBQSxFQUFRLE1BQU0sQ0FBQyxTQUFQLENBQWlCLFFBQWpCLENBQVI7TUFDQSxlQUFBLEVBQWlCLElBRGpCO01BRUEsU0FBQSxFQUFXLEdBRlg7TUFHQSxTQUFBLEVBQVc7SUFIWCxDQURNO0lBS1IsSUFBRyxHQUFHLENBQUMsT0FBUDtNQUNFLE1BQUEsR0FBUyxLQUFLLENBQUMsT0FBTixDQUFBO01BQ1QsT0FBQSxHQUNFO1FBQUEsTUFBQSxFQUFRLE1BQU0sQ0FBQyxTQUFQLENBQWlCLGFBQWpCLENBQVI7UUFDQSxlQUFBLEVBQWlCLElBRGpCO1FBRUEsU0FBQSxFQUFXLEdBRlg7UUFHQSxTQUFBLEVBQVcsS0FIWDtRQUlBLElBQUEsRUFBTSxXQUFXLENBQUMsT0FBWixDQUFvQiw0QkFBcEI7TUFKTjtNQUtGLEtBQUssQ0FBQyxXQUFOLENBQWtCLFdBQWxCLEVBQStCLEdBQUcsQ0FBQyxXQUFuQyxFQUFnRCxPQUFoRCxFQVJGO0tBTkY7O0VBZUEsU0FBQSxHQUFZO0VBQ1osSUFBRyx1QkFBQSxJQUFtQixHQUFHLENBQUMsU0FBSixLQUFpQixLQUF2QztJQUNFLFNBQUEsR0FBWSxNQURkOztFQUVBLElBQUcsU0FBSDtJQUNFLE9BQU8sQ0FBQyxXQUFSLENBQW9CLFFBQXBCLEVBQThCLFNBQTlCLEVBQ0U7TUFBQSxlQUFBLEVBQWlCLElBQWpCO01BQ0EsU0FBQSxFQUFXLEdBRFg7TUFFQSxTQUFBLEVBQVc7SUFGWCxDQURGLEVBREY7O0FBS0EsU0FBTztBQWhETzs7QUFrRGhCLE9BQUEsUUFBZSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBCYWNrYm9uZSBmcm9tICdiYWNrYm9uZSdcbmltcG9ydCB7IFJlZ2lvbiB9IGZyb20gJ2JhY2tib25lLm1hcmlvbmV0dGUnXG5cbmltcG9ydCBSb290QXBwIGZyb20gJy4vcm9vdC1hcHAnXG5pbXBvcnQgTWVzc2FnZXNBcHAgZnJvbSAnLi90a21lc3NhZ2VzJ1xuaW1wb3J0IE5hdmJhckFwcCBmcm9tICcuL3RrbmF2YmFyJ1xuaW1wb3J0IFJvdXRlckFwcCBmcm9tICcuL3Rrcm91dGVyJ1xuXG5NYWluQ2hhbm5lbCA9IEJhY2tib25lLlJhZGlvLmNoYW5uZWwgJ2dsb2JhbCdcblxuY3JlYXRlTWFpbkFwcCA9IChjZmcpIC0+XG4gIHJvb3RFbCA9IGNmZz8uYXBwUmVnaW9uIG9yICdib2R5J1xuICByb290UmVnaW9uID0gbmV3IFJlZ2lvbiBlbDogcm9vdEVsXG4gIG1haW5BcHAgPSBuZXcgUm9vdEFwcFxuICAgIGFwcENvbmZpZzogY2ZnXG4gICAgcmVnaW9uOiByb290UmVnaW9uXG4gIG1haW5BcHAuc2V0U3RhdGUgJ2FwcENvbmZpZycsIGNmZ1xuICBNYWluQ2hhbm5lbC5yZXBseSAnbWFpbjphcHA6b2JqZWN0JywgLT5cbiAgICByZXR1cm4gbWFpbkFwcFxuICBNYWluQ2hhbm5lbC5yZXBseSAnbWFpbjphcHA6Y29uZmlnJywgLT5cbiAgICByZXR1cm4gbWFpbkFwcC5nZXRPcHRpb24gJ2FwcENvbmZpZydcbiAgbGF5b3V0ID0gbWFpbkFwcC5nZXRWaWV3KClcbiAgIyBzZXR1cCBtZXNzYWdlc1xuICB1c2VNZXNzYWdlcyA9IHRydWVcbiAgaWYgY2ZnLnVzZU1lc3NhZ2VzPyBhbmQgY2ZnLnVzZU1lc3NhZ2VzIGlzIGZhbHNlXG4gICAgdXNlTWVzc2FnZXMgPSBmYWxzZVxuICBpZiB1c2VNZXNzYWdlc1xuICAgIG1haW5BcHAuYWRkQ2hpbGRBcHAgJ21lc3NhZ2VzJywgTWVzc2FnZXNBcHAsXG4gICAgICByZWdpb246IGxheW91dC5nZXRSZWdpb24gJ21lc3NhZ2VzJ1xuICAgICAgYXBwQ29uZmlnOiBjZmdcbiAgICAgIHBhcmVudEFwcDogbWFpbkFwcFxuICAjIHNldHVwIG5hdmJhclxuICB1c2VOYXZiYXIgPSB0cnVlXG4gIGlmIGNmZy51c2VOYXZiYXI/IGFuZCBjZmcudXNlTmF2YmFyIGlzIGZhbHNlXG4gICAgdXNlTmF2YmFyID0gZmFsc2VcbiAgaWYgdXNlTmF2YmFyXG4gICAgbmJBcHAgPSBtYWluQXBwLmFkZENoaWxkQXBwICduYXZiYXInLCBOYXZiYXJBcHAsXG4gICAgICByZWdpb246IGxheW91dC5nZXRSZWdpb24gJ25hdmJhcidcbiAgICAgIHN0YXJ0V2l0aFBhcmVudDogdHJ1ZVxuICAgICAgYXBwQ29uZmlnOiBjZmdcbiAgICAgIHBhcmVudEFwcDogbWFpbkFwcFxuICAgIGlmIGNmZy5oYXNVc2VyXG4gICAgICBuYnZpZXcgPSBuYkFwcC5nZXRWaWV3KClcbiAgICAgIG9wdGlvbnMgPVxuICAgICAgICByZWdpb246IG5idmlldy5nZXRSZWdpb24gJ3VzZXJFbnRyaWVzJ1xuICAgICAgICBzdGFydFdpdGhQYXJlbnQ6IHRydWVcbiAgICAgICAgYXBwQ29uZmlnOiBjZmdcbiAgICAgICAgcGFyZW50QXBwOiBuYkFwcFxuICAgICAgICB1c2VyOiBNYWluQ2hhbm5lbC5yZXF1ZXN0IFwibWFpbjphcHA6ZGVjb2RlLWF1dGgtdG9rZW5cIlxuICAgICAgbmJBcHAuYWRkQ2hpbGRBcHAgJ3VzZXItbWVudScsIGNmZy51c2VyTWVudUFwcCwgb3B0aW9uc1xuICB1c2VSb3V0ZXIgPSB0cnVlXG4gIGlmIGNmZy51c2VSb3V0ZXI/IGFuZCBjZmcudXNlUm91dGVyIGlzIGZhbHNlXG4gICAgdXNlUm91dGVyID0gZmFsc2VcbiAgaWYgdXNlUm91dGVyXG4gICAgbWFpbkFwcC5hZGRDaGlsZEFwcCAncm91dGVyJywgUm91dGVyQXBwLFxuICAgICAgc3RhcnRXaXRoUGFyZW50OiB0cnVlXG4gICAgICBhcHBDb25maWc6IGNmZ1xuICAgICAgcGFyZW50QXBwOiBtYWluQXBwXG4gIHJldHVybiBtYWluQXBwXG5cbmV4cG9ydCBkZWZhdWx0IGNyZWF0ZU1haW5BcHBcblxuICAgIFxuICAgIFxuIl19
