var MainChannel, createMainApp;

import Backbone from 'backbone';

import {
  Region
} from 'backbone.marionette';

import tc from 'teacup';

import RootApp from './root-app';

import MessagesApp from './tkmessages';

import NavbarApp from './tknavbar';

MainChannel = Backbone.Radio.channel('global');

createMainApp = function(cfg) {
  var layout, mainApp, msgApp, nbApp, nbview, options, rootEl, rootRegion, useMessages, useNavbar, userMenuApp;
  rootEl = (cfg != null ? cfg.appRegion : void 0) || 'body';
  rootRegion = new Region({
    el: rootEl
  });
  mainApp = new RootApp({
    appConfig: cfg,
    region: rootRegion
  });
  MainChannel.reply('main:app:object', function() {
    return mainApp;
  });
  MainChannel.reply('main:app:config', function() {
    return cfg;
  });
  layout = mainApp.getView();
  // setup messages
  useMessages = true;
  if ((cfg.useMessages != null) && cfg.useMessages === false) {
    useMessages = false;
  }
  if (useMessages) {
    msgApp = mainApp.addChildApp('messages', MessagesApp, {
      region: layout.getRegion('messages'),
      appConfig: cfg,
      parentApp: mainApp
    });
  }
  // setup navbar
  useNavbar = true;
  if ((cfg.useNavbar != null) && cfg.useNavbar === false) {
    useNavbar = false;
  }
  if (useNavbar) {
    nbApp = mainApp.addChildApp('navbar', NavbarApp, {
      region: layout.getRegion('navbar'),
      startWithParent: true,
      appConfig: cfg,
      parentApp: mainApp
    });
    if (cfg.hasUser) {
      nbview = nbApp.getView();
      options = {
        region: nbview.getRegion('userEntries'),
        startWithParent: true,
        appConfig: cfg,
        parentApp: nbApp,
        user: MainChannel.request("main:app:decode-auth-token")
      };
      userMenuApp = nbApp.addChildApp('user-menu', cfg.userMenuApp, options);
    }
  }
  return mainApp;
};

export default createMainApp;

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhcnQtbWFpbi1hcHAuanMiLCJzb3VyY2VzIjpbInN0YXJ0LW1haW4tYXBwLmNvZmZlZSJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxJQUFBLFdBQUEsRUFBQTs7QUFBQSxPQUFPLFFBQVAsTUFBQTs7QUFDQSxPQUFBO0VBQVMsTUFBVDtDQUFBLE1BQUE7O0FBQ0EsT0FBTyxFQUFQLE1BQUE7O0FBRUEsT0FBTyxPQUFQLE1BQUE7O0FBQ0EsT0FBTyxXQUFQLE1BQUE7O0FBQ0EsT0FBTyxTQUFQLE1BQUE7O0FBRUEsV0FBQSxHQUFjLFFBQVEsQ0FBQyxLQUFLLENBQUMsT0FBZixDQUF1QixRQUF2Qjs7QUFFZCxhQUFBLEdBQWdCLFFBQUEsQ0FBQyxHQUFELENBQUE7QUFDZCxNQUFBLE1BQUEsRUFBQSxPQUFBLEVBQUEsTUFBQSxFQUFBLEtBQUEsRUFBQSxNQUFBLEVBQUEsT0FBQSxFQUFBLE1BQUEsRUFBQSxVQUFBLEVBQUEsV0FBQSxFQUFBLFNBQUEsRUFBQTtFQUFBLE1BQUEsa0JBQVMsR0FBRyxDQUFFLG1CQUFMLElBQWtCO0VBQzNCLFVBQUEsR0FBYSxJQUFJLE1BQUosQ0FBVztJQUFBLEVBQUEsRUFBSTtFQUFKLENBQVg7RUFDYixPQUFBLEdBQVUsSUFBSSxPQUFKLENBQ1I7SUFBQSxTQUFBLEVBQVcsR0FBWDtJQUNBLE1BQUEsRUFBUTtFQURSLENBRFE7RUFHVixXQUFXLENBQUMsS0FBWixDQUFrQixpQkFBbEIsRUFBcUMsUUFBQSxDQUFBLENBQUE7QUFDbkMsV0FBTztFQUQ0QixDQUFyQztFQUVBLFdBQVcsQ0FBQyxLQUFaLENBQWtCLGlCQUFsQixFQUFxQyxRQUFBLENBQUEsQ0FBQTtBQUNuQyxXQUFPO0VBRDRCLENBQXJDO0VBRUEsTUFBQSxHQUFTLE9BQU8sQ0FBQyxPQUFSLENBQUEsRUFUVDs7RUFXQSxXQUFBLEdBQWM7RUFDZCxJQUFHLHlCQUFBLElBQXFCLEdBQUcsQ0FBQyxXQUFKLEtBQW1CLEtBQTNDO0lBQ0UsV0FBQSxHQUFjLE1BRGhCOztFQUVBLElBQUcsV0FBSDtJQUNFLE1BQUEsR0FBUyxPQUFPLENBQUMsV0FBUixDQUFvQixVQUFwQixFQUFnQyxXQUFoQyxFQUNQO01BQUEsTUFBQSxFQUFRLE1BQU0sQ0FBQyxTQUFQLENBQWlCLFVBQWpCLENBQVI7TUFDQSxTQUFBLEVBQVcsR0FEWDtNQUVBLFNBQUEsRUFBVztJQUZYLENBRE8sRUFEWDtHQWRBOztFQW9CQSxTQUFBLEdBQVk7RUFDWixJQUFHLHVCQUFBLElBQW1CLEdBQUcsQ0FBQyxTQUFKLEtBQWlCLEtBQXZDO0lBQ0UsU0FBQSxHQUFZLE1BRGQ7O0VBRUEsSUFBRyxTQUFIO0lBQ0UsS0FBQSxHQUFRLE9BQU8sQ0FBQyxXQUFSLENBQW9CLFFBQXBCLEVBQThCLFNBQTlCLEVBQ047TUFBQSxNQUFBLEVBQVEsTUFBTSxDQUFDLFNBQVAsQ0FBaUIsUUFBakIsQ0FBUjtNQUNBLGVBQUEsRUFBaUIsSUFEakI7TUFFQSxTQUFBLEVBQVcsR0FGWDtNQUdBLFNBQUEsRUFBVztJQUhYLENBRE07SUFLUixJQUFHLEdBQUcsQ0FBQyxPQUFQO01BQ0UsTUFBQSxHQUFTLEtBQUssQ0FBQyxPQUFOLENBQUE7TUFDVCxPQUFBLEdBQ0U7UUFBQSxNQUFBLEVBQVEsTUFBTSxDQUFDLFNBQVAsQ0FBaUIsYUFBakIsQ0FBUjtRQUNBLGVBQUEsRUFBaUIsSUFEakI7UUFFQSxTQUFBLEVBQVcsR0FGWDtRQUdBLFNBQUEsRUFBVyxLQUhYO1FBSUEsSUFBQSxFQUFNLFdBQVcsQ0FBQyxPQUFaLENBQW9CLDRCQUFwQjtNQUpOO01BS0YsV0FBQSxHQUFjLEtBQUssQ0FBQyxXQUFOLENBQWtCLFdBQWxCLEVBQStCLEdBQUcsQ0FBQyxXQUFuQyxFQUFnRCxPQUFoRCxFQVJoQjtLQU5GOztBQWVBLFNBQU87QUF2Q087O0FBeUNoQixPQUFBLFFBQWUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQmFja2JvbmUgZnJvbSAnYmFja2JvbmUnXG5pbXBvcnQgeyBSZWdpb24gfSBmcm9tICdiYWNrYm9uZS5tYXJpb25ldHRlJ1xuaW1wb3J0IHRjIGZyb20gJ3RlYWN1cCdcblxuaW1wb3J0IFJvb3RBcHAgZnJvbSAnLi9yb290LWFwcCdcbmltcG9ydCBNZXNzYWdlc0FwcCBmcm9tICcuL3RrbWVzc2FnZXMnXG5pbXBvcnQgTmF2YmFyQXBwIGZyb20gJy4vdGtuYXZiYXInXG5cbk1haW5DaGFubmVsID0gQmFja2JvbmUuUmFkaW8uY2hhbm5lbCAnZ2xvYmFsJ1xuXG5jcmVhdGVNYWluQXBwID0gKGNmZykgLT5cbiAgcm9vdEVsID0gY2ZnPy5hcHBSZWdpb24gb3IgJ2JvZHknXG4gIHJvb3RSZWdpb24gPSBuZXcgUmVnaW9uIGVsOiByb290RWxcbiAgbWFpbkFwcCA9IG5ldyBSb290QXBwXG4gICAgYXBwQ29uZmlnOiBjZmdcbiAgICByZWdpb246IHJvb3RSZWdpb25cbiAgTWFpbkNoYW5uZWwucmVwbHkgJ21haW46YXBwOm9iamVjdCcsIC0+XG4gICAgcmV0dXJuIG1haW5BcHBcbiAgTWFpbkNoYW5uZWwucmVwbHkgJ21haW46YXBwOmNvbmZpZycsIC0+XG4gICAgcmV0dXJuIGNmZ1xuICBsYXlvdXQgPSBtYWluQXBwLmdldFZpZXcoKVxuICAjIHNldHVwIG1lc3NhZ2VzXG4gIHVzZU1lc3NhZ2VzID0gdHJ1ZVxuICBpZiBjZmcudXNlTWVzc2FnZXM/IGFuZCBjZmcudXNlTWVzc2FnZXMgaXMgZmFsc2VcbiAgICB1c2VNZXNzYWdlcyA9IGZhbHNlXG4gIGlmIHVzZU1lc3NhZ2VzXG4gICAgbXNnQXBwID0gbWFpbkFwcC5hZGRDaGlsZEFwcCAnbWVzc2FnZXMnLCBNZXNzYWdlc0FwcCxcbiAgICAgIHJlZ2lvbjogbGF5b3V0LmdldFJlZ2lvbiAnbWVzc2FnZXMnXG4gICAgICBhcHBDb25maWc6IGNmZ1xuICAgICAgcGFyZW50QXBwOiBtYWluQXBwXG4gICMgc2V0dXAgbmF2YmFyXG4gIHVzZU5hdmJhciA9IHRydWVcbiAgaWYgY2ZnLnVzZU5hdmJhcj8gYW5kIGNmZy51c2VOYXZiYXIgaXMgZmFsc2VcbiAgICB1c2VOYXZiYXIgPSBmYWxzZVxuICBpZiB1c2VOYXZiYXJcbiAgICBuYkFwcCA9IG1haW5BcHAuYWRkQ2hpbGRBcHAgJ25hdmJhcicsIE5hdmJhckFwcCxcbiAgICAgIHJlZ2lvbjogbGF5b3V0LmdldFJlZ2lvbiAnbmF2YmFyJ1xuICAgICAgc3RhcnRXaXRoUGFyZW50OiB0cnVlXG4gICAgICBhcHBDb25maWc6IGNmZ1xuICAgICAgcGFyZW50QXBwOiBtYWluQXBwXG4gICAgaWYgY2ZnLmhhc1VzZXJcbiAgICAgIG5idmlldyA9IG5iQXBwLmdldFZpZXcoKVxuICAgICAgb3B0aW9ucyA9XG4gICAgICAgIHJlZ2lvbjogbmJ2aWV3LmdldFJlZ2lvbiAndXNlckVudHJpZXMnXG4gICAgICAgIHN0YXJ0V2l0aFBhcmVudDogdHJ1ZVxuICAgICAgICBhcHBDb25maWc6IGNmZ1xuICAgICAgICBwYXJlbnRBcHA6IG5iQXBwXG4gICAgICAgIHVzZXI6IE1haW5DaGFubmVsLnJlcXVlc3QgXCJtYWluOmFwcDpkZWNvZGUtYXV0aC10b2tlblwiXG4gICAgICB1c2VyTWVudUFwcCA9IG5iQXBwLmFkZENoaWxkQXBwICd1c2VyLW1lbnUnLCBjZmcudXNlck1lbnVBcHAsIG9wdGlvbnNcbiAgcmV0dXJuIG1haW5BcHBcblxuZXhwb3J0IGRlZmF1bHQgY3JlYXRlTWFpbkFwcFxuXG4gICAgXG4gICAgXG4iXX0=
